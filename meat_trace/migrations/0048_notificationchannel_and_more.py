# Generated by Django 5.2.6 on 2025-11-13 08:15

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('meat_trace', '0047_add_configuration_models'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='NotificationChannel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('channel_type', models.CharField(choices=[('email', 'Email'), ('sms', 'SMS'), ('push', 'Push Notification'), ('in_app', 'In-App Notification')], max_length=10)),
                ('is_active', models.BooleanField(default=True)),
                ('config', models.JSONField(default=dict, help_text='Channel-specific configuration (API keys, endpoints, etc.)')),
                ('rate_limit_per_minute', models.PositiveIntegerField(default=60)),
                ('rate_limit_per_hour', models.PositiveIntegerField(default=1000)),
                ('rate_limit_per_day', models.PositiveIntegerField(default=10000)),
                ('provider_name', models.CharField(blank=True, help_text='Name of the service provider', max_length=100)),
                ('provider_config', models.JSONField(default=dict, help_text='Provider-specific configuration')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.AlterField(
            model_name='notification',
            name='notification_type',
            field=models.CharField(choices=[('join_request', 'Join Request'), ('join_approved', 'Join Request Approved'), ('join_rejected', 'Join Request Rejected'), ('invitation', 'User Invitation'), ('role_change', 'Role Changed'), ('profile_update', 'Profile Update Required'), ('verification', 'Account Verification'), ('animal_rejected', 'Animal Rejected'), ('part_rejected', 'Slaughter Part Rejected'), ('appeal_submitted', 'Appeal Submitted'), ('appeal_approved', 'Appeal Approved'), ('appeal_denied', 'Appeal Denied'), ('system_alert', 'System Alert'), ('maintenance', 'Maintenance Notice'), ('custom', 'Custom Notification')], max_length=30),
        ),
        migrations.CreateModel(
            name='AuditTrail',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_date', models.DateField(help_text='Date of the audit event (used for partitioning)')),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, help_text='Exact timestamp of the event')),
                ('action_type', models.CharField(choices=[('create', 'Create'), ('update', 'Update'), ('delete', 'Delete'), ('view', 'View'), ('export', 'Export'), ('login', 'Login'), ('logout', 'Logout'), ('transfer', 'Transfer'), ('reject', 'Reject'), ('approve', 'Approve'), ('audit', 'Audit'), ('compliance_check', 'Compliance Check'), ('system', 'System Action')], max_length=20)),
                ('entity_type', models.CharField(choices=[('user', 'User'), ('animal', 'Animal'), ('slaughter_part', 'Slaughter Part'), ('product', 'Product'), ('processing_unit', 'Processing Unit'), ('shop', 'Shop'), ('order', 'Order'), ('sale', 'Sale'), ('inventory', 'Inventory'), ('system', 'System')], max_length=20)),
                ('entity_id', models.PositiveIntegerField(blank=True, help_text='ID of the entity being audited', null=True)),
                ('user_role', models.CharField(blank=True, help_text='Role of the user at time of action', max_length=20, null=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('action_description', models.TextField(help_text='Description of the action performed')),
                ('old_values', models.JSONField(blank=True, default=dict, help_text='Previous values before the change')),
                ('new_values', models.JSONField(blank=True, default=dict, help_text='New values after the change')),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='low', max_length=10)),
                ('compliance_related', models.BooleanField(default=False, help_text='Whether this action is compliance-related')),
                ('security_event', models.BooleanField(default=False, help_text='Whether this is a security-related event')),
                ('session_id', models.CharField(blank=True, help_text='User session identifier', max_length=100, null=True)),
                ('request_id', models.CharField(blank=True, help_text='Request identifier for tracing', max_length=100, null=True)),
                ('api_endpoint', models.CharField(blank=True, help_text='API endpoint accessed', max_length=200, null=True)),
                ('http_method', models.CharField(blank=True, help_text='HTTP method used', max_length=10, null=True)),
                ('audit_batch_id', models.CharField(blank=True, help_text='Batch ID for grouped audit operations', max_length=100, null=True)),
                ('retention_class', models.CharField(default='standard', help_text='Data retention classification', max_length=20)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional audit metadata')),
                ('tags', models.JSONField(blank=True, default=list, help_text='Tags for categorization and filtering')),
                ('processing_unit', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_trail', to='meat_trace.processingunit')),
                ('shop', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_trail', to='meat_trace.shop')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_trail_entries', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='Backup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for the backup', max_length=200)),
                ('backup_id', models.CharField(editable=False, help_text='Auto-generated unique backup identifier', max_length=50, unique=True)),
                ('backup_type', models.CharField(choices=[('full', 'Full Backup'), ('incremental', 'Incremental Backup'), ('differential', 'Differential Backup')], default='full', max_length=20)),
                ('include_database', models.BooleanField(default=True, help_text='Include database in backup')),
                ('include_files', models.BooleanField(default=True, help_text='Include uploaded files in backup')),
                ('include_media', models.BooleanField(default=True, help_text='Include media files in backup')),
                ('tables_to_include', models.JSONField(blank=True, default=list, help_text='Specific tables to include (empty means all)')),
                ('tables_to_exclude', models.JSONField(blank=True, default=list, help_text='Tables to exclude from backup')),
                ('status', models.CharField(choices=[('scheduled', 'Scheduled'), ('running', 'Running'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='scheduled', max_length=20)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('file_path', models.CharField(blank=True, help_text='Path to backup file', max_length=500, null=True)),
                ('file_size_bytes', models.BigIntegerField(blank=True, help_text='Size of backup file in bytes', null=True)),
                ('scheduled_at', models.DateTimeField(blank=True, help_text='When the backup was scheduled', null=True)),
                ('started_at', models.DateTimeField(blank=True, help_text='When the backup started', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When the backup completed', null=True)),
                ('error_message', models.TextField(blank=True, help_text='Error message if backup failed', null=True)),
                ('retry_count', models.PositiveIntegerField(default=0, help_text='Number of retry attempts')),
                ('retention_days', models.PositiveIntegerField(default=30, help_text='How long to keep this backup')),
                ('is_archived', models.BooleanField(default=False, help_text='Whether backup has been archived')),
                ('archived_at', models.DateTimeField(blank=True, help_text='When backup was archived', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional backup metadata')),
                ('checksum', models.CharField(blank=True, help_text='Checksum for backup integrity verification', max_length=128, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_backups', to=settings.AUTH_USER_MODEL)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='initiated_backups', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceStatus',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('entity_type', models.CharField(choices=[('processing_unit', 'Processing Unit'), ('shop', 'Shop'), ('product', 'Product'), ('animal', 'Animal'), ('user', 'User')], max_length=20)),
                ('entity_id', models.PositiveIntegerField(help_text='ID of the entity being tracked')),
                ('compliance_level', models.CharField(choices=[('compliant', 'Compliant'), ('warning', 'Warning'), ('non_compliant', 'Non-Compliant'), ('critical', 'Critical Violation')], default='compliant', max_length=20)),
                ('compliance_score', models.DecimalField(decimal_places=2, help_text='Compliance score (0-100)', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('issues_count', models.PositiveIntegerField(default=0, help_text='Number of compliance issues')),
                ('critical_issues_count', models.PositiveIntegerField(default=0, help_text='Number of critical compliance issues')),
                ('last_violation_date', models.DateTimeField(blank=True, help_text='Date of last compliance violation', null=True)),
                ('required_certifications', models.JSONField(default=list, help_text='List of required certifications')),
                ('obtained_certifications', models.JSONField(default=list, help_text='List of obtained certifications')),
                ('certification_expiry_dates', models.JSONField(default=dict, help_text='Certification expiry dates')),
                ('traceability_score', models.DecimalField(decimal_places=2, default=100, help_text='Traceability compliance score', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('documentation_completeness', models.DecimalField(decimal_places=2, default=100, help_text='Documentation completeness score', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('quality_score', models.DecimalField(decimal_places=2, default=100, help_text='Quality compliance score', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('safety_score', models.DecimalField(decimal_places=2, default=100, help_text='Safety compliance score', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('last_audit_date', models.DateTimeField(blank=True, help_text='Date of last compliance audit', null=True)),
                ('next_audit_due', models.DateTimeField(blank=True, help_text='Date when next audit is due', null=True)),
                ('audit_frequency_days', models.PositiveIntegerField(default=90, help_text='Audit frequency in days')),
                ('is_active', models.BooleanField(default=True, help_text='Whether this compliance record is active')),
                ('status_updated_at', models.DateTimeField(auto_now=True)),
                ('compliance_notes', models.TextField(blank=True, help_text='Additional compliance notes', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional compliance metadata')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('status_updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='compliance_status_updates', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='DataExport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for the export', max_length=200)),
                ('export_id', models.CharField(editable=False, help_text='Auto-generated unique export identifier', max_length=50, unique=True)),
                ('export_format', models.CharField(choices=[('csv', 'CSV'), ('json', 'JSON'), ('xml', 'XML'), ('excel', 'Excel')], default='csv', max_length=10)),
                ('include_related_data', models.BooleanField(default=True, help_text='Include related/foreign key data')),
                ('models_to_export', models.JSONField(blank=True, default=list, help_text='Specific models to export (empty means all)')),
                ('filters', models.JSONField(blank=True, default=dict, help_text='Filters to apply to exported data')),
                ('date_range_start', models.DateTimeField(blank=True, help_text='Start date for data filtering', null=True)),
                ('date_range_end', models.DateTimeField(blank=True, help_text='End date for data filtering', null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('running', 'Running'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('records_exported', models.PositiveIntegerField(default=0, help_text='Number of records exported')),
                ('file_path', models.CharField(blank=True, help_text='Path to exported file', max_length=500, null=True)),
                ('file_size_bytes', models.BigIntegerField(blank=True, help_text='Size of exported file in bytes', null=True)),
                ('scheduled_at', models.DateTimeField(blank=True, help_text='When the export was scheduled', null=True)),
                ('started_at', models.DateTimeField(blank=True, help_text='When the export started', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When the export completed', null=True)),
                ('error_message', models.TextField(blank=True, help_text='Error message if export failed', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional export metadata')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_exports', to=settings.AUTH_USER_MODEL)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='initiated_exports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DataImport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for the import', max_length=200)),
                ('import_id', models.CharField(editable=False, help_text='Auto-generated unique import identifier', max_length=50, unique=True)),
                ('import_format', models.CharField(choices=[('csv', 'CSV'), ('json', 'JSON'), ('xml', 'XML'), ('excel', 'Excel')], default='csv', max_length=10)),
                ('source_file_path', models.CharField(help_text='Path to source file for import', max_length=500)),
                ('target_model', models.CharField(help_text='Django model to import data into', max_length=100)),
                ('update_existing', models.BooleanField(default=False, help_text='Update existing records if they match')),
                ('skip_duplicates', models.BooleanField(default=True, help_text='Skip duplicate records')),
                ('validate_data', models.BooleanField(default=True, help_text='Validate data before import')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('validating', 'Validating'), ('running', 'Running'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('records_processed', models.PositiveIntegerField(default=0, help_text='Number of records processed')),
                ('records_imported', models.PositiveIntegerField(default=0, help_text='Number of records successfully imported')),
                ('records_failed', models.PositiveIntegerField(default=0, help_text='Number of records that failed to import')),
                ('validation_errors', models.JSONField(blank=True, default=list, help_text='List of validation errors')),
                ('duplicate_records', models.JSONField(blank=True, default=list, help_text='List of duplicate records found')),
                ('scheduled_at', models.DateTimeField(blank=True, help_text='When the import was scheduled', null=True)),
                ('started_at', models.DateTimeField(blank=True, help_text='When the import started', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When the import completed', null=True)),
                ('error_message', models.TextField(blank=True, help_text='Error message if import failed', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional import metadata')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_imports', to=settings.AUTH_USER_MODEL)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='initiated_imports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DataValidation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Descriptive name for the validation', max_length=200)),
                ('validation_id', models.CharField(editable=False, help_text='Auto-generated unique validation identifier', max_length=50, unique=True)),
                ('validation_type', models.CharField(choices=[('schema_validation', 'Schema Validation'), ('referential_integrity', 'Referential Integrity'), ('data_consistency', 'Data Consistency'), ('business_rules', 'Business Rules'), ('custom_validation', 'Custom Validation')], max_length=25)),
                ('target_models', models.JSONField(blank=True, default=list, help_text='Models to validate')),
                ('validation_rules', models.JSONField(blank=True, default=dict, help_text='Validation rules and parameters')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('running', 'Running'), ('passed', 'Passed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('records_checked', models.PositiveIntegerField(default=0, help_text='Number of records checked')),
                ('records_passed', models.PositiveIntegerField(default=0, help_text='Number of records that passed validation')),
                ('records_failed', models.PositiveIntegerField(default=0, help_text='Number of records that failed validation')),
                ('validation_errors', models.JSONField(blank=True, default=list, help_text='List of validation errors found')),
                ('error_summary', models.JSONField(blank=True, default=dict, help_text='Summary of validation errors')),
                ('scheduled_at', models.DateTimeField(blank=True, help_text='When the validation was scheduled', null=True)),
                ('started_at', models.DateTimeField(blank=True, help_text='When the validation started', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When the validation completed', null=True)),
                ('error_message', models.TextField(blank=True, help_text='Error message if validation failed', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional validation metadata')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_validations', to=settings.AUTH_USER_MODEL)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='initiated_validations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='GDPRRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('request_id', models.CharField(editable=False, help_text='Auto-generated unique request identifier', max_length=50, unique=True)),
                ('request_type', models.CharField(choices=[('data_deletion', 'Data Deletion'), ('data_anonymization', 'Data Anonymization'), ('data_portability', 'Data Portability'), ('access_request', 'Access Request')], max_length=20)),
                ('justification', models.TextField(blank=True, help_text="User's justification for the request", null=True)),
                ('data_categories', models.JSONField(blank=True, default=list, help_text='Categories of data to process')),
                ('date_range_start', models.DateTimeField(blank=True, help_text='Start date for data processing', null=True)),
                ('date_range_end', models.DateTimeField(blank=True, help_text='End date for data processing', null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('rejected', 'Rejected'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('processed_data_summary', models.JSONField(blank=True, default=dict, help_text='Summary of data processed')),
                ('anonymized_fields', models.JSONField(blank=True, default=list, help_text='Fields that were anonymized')),
                ('deleted_records', models.JSONField(blank=True, default=list, help_text='Records that were deleted')),
                ('admin_notes', models.TextField(blank=True, help_text='Admin notes on processing', null=True)),
                ('response_message', models.TextField(blank=True, help_text='Response message to user', null=True)),
                ('requested_at', models.DateTimeField(default=django.utils.timezone.now, help_text='When the request was made')),
                ('processed_at', models.DateTimeField(blank=True, help_text='When the request was processed', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When the request was completed', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional GDPR request metadata')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('processed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='processed_gdpr_requests', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(help_text='User making the request', on_delete=django.db.models.deletion.CASCADE, related_name='gdpr_requests', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-requested_at'],
            },
        ),
        migrations.CreateModel(
            name='NotificationDelivery',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('delivered', 'Delivered'), ('failed', 'Failed'), ('retrying', 'Retrying'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('external_id', models.CharField(blank=True, help_text='External service message ID', max_length=255)),
                ('error_message', models.TextField(blank=True, help_text='Error message if delivery failed')),
                ('retry_count', models.PositiveIntegerField(default=0)),
                ('max_retries', models.PositiveIntegerField(default=3)),
                ('next_retry_at', models.DateTimeField(blank=True, null=True)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('delivered_at', models.DateTimeField(blank=True, null=True)),
                ('failed_at', models.DateTimeField(blank=True, null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Delivery-specific metadata')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('channel', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='meat_trace.notificationchannel')),
                ('notification', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deliveries', to='meat_trace.notification')),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notification_deliveries', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='NotificationRateLimit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('minute_count', models.PositiveIntegerField(default=0)),
                ('hour_count', models.PositiveIntegerField(default=0)),
                ('day_count', models.PositiveIntegerField(default=0)),
                ('minute_reset', models.DateTimeField(default=django.utils.timezone.now)),
                ('hour_reset', models.DateTimeField(default=django.utils.timezone.now)),
                ('day_reset', models.DateTimeField(default=django.utils.timezone.now)),
                ('channel', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='meat_trace.notificationchannel')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rate_limits', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='NotificationSchedule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('schedule_type', models.CharField(choices=[('one_time', 'One Time'), ('recurring', 'Recurring')], default='one_time', max_length=10)),
                ('recipient_groups', models.JSONField(blank=True, default=list, help_text="Groups to send to (e.g., ['abbatoirs', 'processors'])")),
                ('notification_type', models.CharField(choices=[('join_request', 'Join Request'), ('join_approved', 'Join Request Approved'), ('join_rejected', 'Join Request Rejected'), ('invitation', 'User Invitation'), ('role_change', 'Role Changed'), ('profile_update', 'Profile Update Required'), ('verification', 'Account Verification'), ('animal_rejected', 'Animal Rejected'), ('part_rejected', 'Slaughter Part Rejected'), ('appeal_submitted', 'Appeal Submitted'), ('appeal_approved', 'Appeal Approved'), ('appeal_denied', 'Appeal Denied'), ('system_alert', 'System Alert'), ('maintenance', 'Maintenance Notice'), ('custom', 'Custom Notification')], max_length=30)),
                ('title_template', models.CharField(max_length=200)),
                ('message_template', models.TextField()),
                ('template_variables', models.JSONField(blank=True, default=dict)),
                ('scheduled_at', models.DateTimeField(blank=True, null=True)),
                ('frequency', models.CharField(blank=True, choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly')], max_length=10, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('channels', models.ManyToManyField(blank=True, to='meat_trace.notificationchannel')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_schedules', to=settings.AUTH_USER_MODEL)),
                ('recipient_users', models.ManyToManyField(blank=True, related_name='scheduled_notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-scheduled_at'],
            },
        ),
        migrations.AddField(
            model_name='notification',
            name='schedule',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='meat_trace.notificationschedule'),
        ),
        migrations.CreateModel(
            name='NotificationTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('template_type', models.CharField(choices=[('email', 'Email'), ('sms', 'SMS'), ('push', 'Push Notification'), ('in_app', 'In-App Notification')], max_length=10)),
                ('subject', models.CharField(blank=True, help_text='Email subject (for email templates)', max_length=200)),
                ('content', models.TextField(help_text='Template content with {{variable}} placeholders')),
                ('variables', models.JSONField(default=list, help_text='List of available variables for this template')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_templates', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='notification',
            name='template',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='meat_trace.notificationtemplate'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['notification_type', 'created_at'], name='meat_trace__notific_efd24f_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['event_date', 'timestamp'], name='meat_trace__event_d_bb0af0_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['entity_type', 'entity_id', 'event_date'], name='meat_trace__entity__6c19b5_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['user', 'event_date'], name='meat_trace__user_id_0fcfbe_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['action_type', 'event_date'], name='meat_trace__action__df5984_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['severity', 'event_date'], name='meat_trace__severit_b4eac5_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['compliance_related', 'event_date'], name='meat_trace__complia_eef46b_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['security_event', 'event_date'], name='meat_trace__securit_d6f0d1_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['processing_unit', 'event_date'], name='meat_trace__process_0b13e3_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['shop', 'event_date'], name='meat_trace__shop_id_8cb0bd_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['retention_class', 'event_date'], name='meat_trace__retenti_afdc25_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['audit_batch_id'], name='meat_trace__audit_b_e9a103_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['session_id'], name='meat_trace__session_cb3d57_idx'),
        ),
        migrations.AddIndex(
            model_name='audittrail',
            index=models.Index(fields=['request_id'], name='meat_trace__request_84226b_idx'),
        ),
        migrations.AddIndex(
            model_name='backup',
            index=models.Index(fields=['status', 'created_at'], name='meat_trace__status_0860f6_idx'),
        ),
        migrations.AddIndex(
            model_name='backup',
            index=models.Index(fields=['backup_type', 'status'], name='meat_trace__backup__af9d95_idx'),
        ),
        migrations.AddIndex(
            model_name='backup',
            index=models.Index(fields=['scheduled_at', 'status'], name='meat_trace__schedul_3ca510_idx'),
        ),
        migrations.AddIndex(
            model_name='backup',
            index=models.Index(fields=['is_archived', 'retention_days'], name='meat_trace__is_arch_3bb423_idx'),
        ),
        migrations.AddIndex(
            model_name='backup',
            index=models.Index(fields=['backup_id'], name='meat_trace__backup__26ca18_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['entity_type', 'compliance_level'], name='meat_trace__entity__4e6627_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['compliance_level', 'last_violation_date'], name='meat_trace__complia_f58157_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['next_audit_due', 'is_active'], name='meat_trace__next_au_290ea5_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['compliance_score'], name='meat_trace__complia_95d126_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['traceability_score'], name='meat_trace__traceab_fe908d_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['quality_score'], name='meat_trace__quality_3279f1_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancestatus',
            index=models.Index(fields=['safety_score'], name='meat_trace__safety__dcc213_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='compliancestatus',
            unique_together={('entity_type', 'entity_id')},
        ),
        migrations.AddIndex(
            model_name='dataexport',
            index=models.Index(fields=['status', 'created_at'], name='meat_trace__status_53f005_idx'),
        ),
        migrations.AddIndex(
            model_name='dataexport',
            index=models.Index(fields=['export_format', 'status'], name='meat_trace__export__080795_idx'),
        ),
        migrations.AddIndex(
            model_name='dataexport',
            index=models.Index(fields=['scheduled_at', 'status'], name='meat_trace__schedul_d666d4_idx'),
        ),
        migrations.AddIndex(
            model_name='dataexport',
            index=models.Index(fields=['export_id'], name='meat_trace__export__700665_idx'),
        ),
        migrations.AddIndex(
            model_name='dataimport',
            index=models.Index(fields=['status', 'created_at'], name='meat_trace__status_d9c3b4_idx'),
        ),
        migrations.AddIndex(
            model_name='dataimport',
            index=models.Index(fields=['import_format', 'status'], name='meat_trace__import__29ad54_idx'),
        ),
        migrations.AddIndex(
            model_name='dataimport',
            index=models.Index(fields=['target_model', 'status'], name='meat_trace__target__9c9ea7_idx'),
        ),
        migrations.AddIndex(
            model_name='dataimport',
            index=models.Index(fields=['scheduled_at', 'status'], name='meat_trace__schedul_2ee777_idx'),
        ),
        migrations.AddIndex(
            model_name='dataimport',
            index=models.Index(fields=['import_id'], name='meat_trace__import__d47a0c_idx'),
        ),
        migrations.AddIndex(
            model_name='datavalidation',
            index=models.Index(fields=['status', 'created_at'], name='meat_trace__status_80bc7a_idx'),
        ),
        migrations.AddIndex(
            model_name='datavalidation',
            index=models.Index(fields=['validation_type', 'status'], name='meat_trace__validat_844f87_idx'),
        ),
        migrations.AddIndex(
            model_name='datavalidation',
            index=models.Index(fields=['scheduled_at', 'status'], name='meat_trace__schedul_4658c9_idx'),
        ),
        migrations.AddIndex(
            model_name='datavalidation',
            index=models.Index(fields=['validation_id'], name='meat_trace__validat_d5fc0b_idx'),
        ),
        migrations.AddIndex(
            model_name='gdprrequest',
            index=models.Index(fields=['status', 'requested_at'], name='meat_trace__status_5c1756_idx'),
        ),
        migrations.AddIndex(
            model_name='gdprrequest',
            index=models.Index(fields=['request_type', 'status'], name='meat_trace__request_62e3f9_idx'),
        ),
        migrations.AddIndex(
            model_name='gdprrequest',
            index=models.Index(fields=['user', 'status'], name='meat_trace__user_id_d1e1f9_idx'),
        ),
        migrations.AddIndex(
            model_name='gdprrequest',
            index=models.Index(fields=['request_id'], name='meat_trace__request_72926c_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationdelivery',
            index=models.Index(fields=['notification', 'status'], name='meat_trace__notific_6d7a1e_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationdelivery',
            index=models.Index(fields=['channel', 'status'], name='meat_trace__channel_b0578a_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationdelivery',
            index=models.Index(fields=['recipient', 'status'], name='meat_trace__recipie_a77cca_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationdelivery',
            index=models.Index(fields=['status', 'next_retry_at'], name='meat_trace__status_0ceda5_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationratelimit',
            index=models.Index(fields=['user', 'channel'], name='meat_trace__user_id_315d24_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationratelimit',
            index=models.Index(fields=['minute_reset'], name='meat_trace__minute__099ed1_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationratelimit',
            index=models.Index(fields=['hour_reset'], name='meat_trace__hour_re_9f3f81_idx'),
        ),
        migrations.AddIndex(
            model_name='notificationratelimit',
            index=models.Index(fields=['day_reset'], name='meat_trace__day_res_2e3017_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='notificationratelimit',
            unique_together={('user', 'channel')},
        ),
    ]
