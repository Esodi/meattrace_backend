{% extends "admin/base.html" %}
{% load static %}
{% block title %}Compliance Dashboard - MeatTrace Admin{% endblock %}
{% block page_title %}Compliance Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <!-- Compliance Status Overview -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-shield-alt fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="card-title mb-0">Compliance Score</h6>
                        <h3 class="mb-0" id="complianceScore">{{ compliance_data.status.overall_score|default:'96%' }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card success">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="card-title mb-0">Passed Tests</h6>
                        <h3 class="mb-0" id="passedTests">{{ compliance_data.tests.passed|default:0 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card warning">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="card-title mb-0">Upcoming Audits</h6>
                        <h3 class="mb-0" id="upcomingAudits">{{ compliance_data.audits.upcoming|default:0 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card info">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-certificate fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="card-title mb-0">Active Certifications</h6>
                        <h3 class="mb-0" id="activeCertifications">{{ compliance_data.certifications.active|default:0 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Quality Tests Overview -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-flask fa-2"></i> Quality Tests
                </h5>
                <button class="btn btn-outline-primary btn-sm" onclick="scheduleTest()">
                    <i class="fas fa-plus me-1"></i>Schedule Test
                </button>
            </div>
            <div class="card-body">
                <canvas id="qualityTestsChart" height="200"></canvas>
                <div class="mt-3">
                    <div class="row text-center">
                        <div class="col-3">
                            <h6 class="text-success">{{ compliance_data.tests.microbiological|default:'98%' }}</h6>
                            <small class="text-muted">Microbiological</small>
                        </div>
                        <div class="col-3">
                            <h6 class="text-primary">{{ compliance_data.tests.chemical|default:'95%' }}</h6>
                            <small class="text-muted">Chemical</small>
                        </div>
                        <div class="col-3">
                            <h6 class="text-warning">{{ compliance_data.tests.physical|default:'97%' }}</h6>
                            <small class="text-muted">Physical</small>
                        </div>
                        <div class="col-3">
                            <h6 class="text-info">{{ compliance_data.tests.sensory|default:'94%' }}</h6>
                            <small class="text-muted">Sensory</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Compliance Issues & Alerts -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-exclamation-triangle fa-2"></i> Compliance Alerts
                </h5>
            </div>
            <div class="card-body">
                <div id="complianceAlertsList">
                    {% for alert in compliance_data.alerts %}
                    <div class="alert alert-{% if alert.severity|lower == 'critical' %}danger{% elif alert.severity|lower == 'warning' %}warning{% else %}info{% endif %} alert-dismissible fade show" role="alert">
                        <strong>{{ alert.title }}</strong>
                        <br><small>{{ alert.description }}</small>
                        <br><small class="text-muted">{{ alert.date|date:"M d, Y" }}</small>
                        {% if alert.action_required %}
                        <br><button class="btn btn-sm btn-outline-primary mt-2" onclick="handleComplianceIssue({{ alert.id }})">Take Action</button>
                        {% endif %}
                        <button type="button" class="btn-close" onclick="dismissAlert({{ alert.id }})"></button>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-check-circle fa-2x mb-2"></i>
                        <p>No compliance issues</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Audit Schedule -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-calendar-alt fa-2"></i> Audit Schedule
                </h5>
                <button class="btn btn-outline-primary btn-sm" onclick="scheduleAudit()">
                    <i class="fas fa-plus me-1"></i>Schedule Audit
                </button>
            </div>
            <div class="card-body">
                <div class="timeline" id="auditTimeline">
                    {% for audit in compliance_data.audits.schedule %}
                    <div class="timeline-item">
                        <div class="timeline-marker bg-{% if audit.status|lower == 'completed' %}success{% elif audit.status|lower == 'scheduled' %}primary{% elif audit.status|lower == 'overdue' %}danger{% else %}warning{% endif %}"></div>
                        <div class="timeline-content">
                            <h6 class="mb-0">{{ audit.type }}</h6>
                            <small class="text-muted">{{ audit.auditor }}</small>
                            <br><small class="text-muted">{{ audit.date|date:"M d, Y" }}</small>
                            <br><span class="badge bg-{% if audit.status|lower == 'completed' %}success{% elif audit.status|lower == 'scheduled' %}primary{% elif audit.status|lower == 'overdue' %}danger{% else %}warning{% endif %}">
                                {{ audit.status|title }}
                            </span>
                            {% if audit.status == 'scheduled' %}
                            <button class="btn btn-sm btn-outline-info ms-2" onclick="viewAuditDetails({{ audit.id }})">View</button>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                        <p>No audits scheduled</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Certifications -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-certificate fa-2"></i> Certifications
                </h5>
                <button class="btn btn-outline-primary btn-sm" onclick="addCertification()">
                    <i class="fas fa-plus me-1"></i>Add Certification
                </button>
            </div>
            <div class="card-body">
                <div class="row g-3" id="certificationsGrid">
                    {% for cert in compliance_data.certifications.list %}
                    <div class="col-md-6">
                        <div class="card border-{% if cert.status|lower == 'active' %}success{% elif cert.status|lower == 'expiring' %}warning{% else %}secondary{% endif %}">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">{{ cert.name }}</h6>
                                        <small class="text-muted">{{ cert.issuing_body }}</small>
                                        <br><small class="text-muted">Expires: {{ cert.expiry_date|date:"M d, Y" }}</small>
                                    </div>
                                    <span class="badge bg-{% if cert.status|lower == 'active' %}success{% elif cert.status|lower == 'expiring' %}warning{% else %}secondary{% endif %}">
                                        {{ cert.status|title }}
                                    </span>
                                </div>
                                {% if cert.days_until_expiry <= 30 %}
                                <div class="mt-2">
                                    <small class="text-danger">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        Expires in {{ cert.days_until_expiry }} days
                                    </small>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center text-muted py-4">
                        <i class="fas fa-certificate fa-2x mb-2"></i>
                        <p>No certifications found</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Compliance Trends -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-line fa-2"></i> Compliance Trends
                </h5>
            </div>
            <div class="card-body">
                <canvas id="complianceTrendsChart" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- Incident Reports -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-flag fa-2"></i> Incident Reports
                </h5>
                <button class="btn btn-outline-danger btn-sm" onclick="reportIncident()">
                    <i class="fas fa-plus me-1"></i>Report Incident
                </button>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush" id="incidentReportsList">
                    {% for incident in compliance_data.incidents.recent %}
                    <div class="list-group-item px-0">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">{{ incident.title }}</h6>
                            <small class="text-muted">{{ incident.date|date:"M d" }}</small>
                        </div>
                        <p class="mb-1 text-muted">{{ incident.description|truncatechars:50 }}</p>
                        <small class="text-{% if incident.severity|lower == 'critical' %}danger{% elif incident.severity|lower == 'major' %}warning{% else %}secondary{% endif %}">
                            {{ incident.severity|title }} - {{ incident.status|title }}
                        </small>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-flag fa-2x mb-2"></i>
                        <p>No recent incidents</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Regulatory Requirements -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-gavel fa-2"></i> Regulatory Requirements Tracker
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="regulatoryRequirementsTable">
                        <thead>
                            <tr>
                                <th>Regulation</th>
                                <th>Requirement</th>
                                <th>Compliance Status</th>
                                <th>Last Audit</th>
                                <th>Next Due</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="regulatoryRequirementsTableBody">
                            {% for req in compliance_data.regulatory_requirements %}
                            <tr>
                                <td>
                                    <strong>{{ req.name }}</strong>
                                    <br><small class="text-muted">{{ req.authority }}</small>
                                </td>
                                <td>{{ req.description }}</td>
                                <td>
                                    <span class="badge bg-{% if req.compliance_status|lower == 'compliant' %}success{% elif req.compliance_status|lower == 'non_compliant' %}danger{% elif req.compliance_status|lower == 'pending' %}warning{% else %}secondary{% endif %}">
                                        {{ req.compliance_status|title }}
                                    </span>
                                </td>
                                <td>
                                    {% if req.last_audit %}
                                        {{ req.last_audit|date:"M d, Y" }}
                                    {% else %}
                                        Never
                                    {% endif %}
                                </td>
                                <td>
                                    {% if req.next_due %}
                                        {{ req.next_due|date:"M d, Y" }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-info" onclick="viewRequirementDetails({{ req.id }})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    {% if req.compliance_status != 'compliant' %}
                                    <button class="btn btn-sm btn-outline-warning" onclick="updateComplianceStatus({{ req.id }})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-4">
                                    <i class="fas fa-gavel fa-2x text-muted mb-2"></i>
                                    <p class="text-muted">No regulatory requirements configured</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Schedule Audit Modal -->
<div class="modal fade" id="scheduleAuditModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Schedule Audit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="scheduleAuditForm">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Audit Type</label>
                            <select class="form-select" name="audit_type" required>
                                <option value="">Select Type</option>
                                <option value="internal">Internal Audit</option>
                                <option value="external">External Audit</option>
                                <option value="regulatory">Regulatory Inspection</option>
                                <option value="supplier">Supplier Audit</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Audit Date</label>
                            <input type="date" class="form-control" name="audit_date" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Auditor/Auditing Body</label>
                            <input type="text" class="form-control" name="auditor" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Scope</label>
                            <textarea class="form-control" name="scope" rows="3" placeholder="Describe what will be audited..."></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="2" placeholder="Additional notes..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Schedule Audit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Report Incident Modal -->
<div class="modal fade" id="reportIncidentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Report Compliance Incident</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="reportIncidentForm">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Incident Title</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Severity</label>
                            <select class="form-select" name="severity" required>
                                <option value="">Select Severity</option>
                                <option value="minor">Minor</option>
                                <option value="major">Major</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Incident Date</label>
                            <input type="date" class="form-control" name="incident_date" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="4" required></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Immediate Actions Taken</label>
                            <textarea class="form-control" name="immediate_actions" rows="3"></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Corrective Actions Planned</label>
                            <textarea class="form-control" name="corrective_actions" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Report Incident</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let qualityTestsChart, complianceTrendsChart;

document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    initializeEventListeners();
    startAutoRefresh(300000); // Refresh every 5 minutes
});

function initializeEventListeners() {
    // Schedule audit form
    document.getElementById('scheduleAuditForm').addEventListener('submit', function(e) {
        e.preventDefault();
        scheduleAuditSubmit(new FormData(this));
    });

    // Report incident form
    document.getElementById('reportIncidentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        reportIncidentSubmit(new FormData(this));
    });
}

function initializeCharts() {
    // Quality Tests Chart
    const qualityCtx = document.getElementById('qualityTestsChart').getContext('2d');
    qualityTestsChart = new Chart(qualityCtx, {
        type: 'doughnut',
        data: {
            labels: {{ compliance_data.charts.quality_tests.labels|default:"['Passed', 'Failed', 'Pending']" }},
            datasets: [{
                data: {{ compliance_data.charts.quality_tests.data|default:"[85, 10, 5]" }},
                backgroundColor: ['#28a745', '#dc3545', '#ffc107']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Compliance Trends Chart
    const trendsCtx = document.getElementById('complianceTrendsChart').getContext('2d');
    complianceTrendsChart = new Chart(trendsCtx, {
        type: 'line',
        data: {
            labels: {{ compliance_data.charts.trends.labels|default:"[]" }},
            datasets: [{
                label: 'Compliance Score',
                data: {{ compliance_data.charts.trends.scores|default:"[]" }},
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Test Pass Rate',
                data: {{ compliance_data.charts.trends.pass_rates|default:"[]" }},
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
}

function scheduleAudit() {
    document.getElementById('scheduleAuditForm').reset();
    new bootstrap.Modal(document.getElementById('scheduleAuditModal')).show();
}

function scheduleAuditSubmit(formData) {
    showLoading();
    fetch('/api/v2/admin/compliance/audits/schedule/', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('scheduleAuditModal')).hide();
            refreshData();
            showSuccess('Audit scheduled successfully');
        } else {
            showError(data.message || 'Failed to schedule audit');
        }
        hideLoading();
    })
    .catch(error => {
        showError('Failed to schedule audit');
        hideLoading();
    });
}

function reportIncident() {
    document.getElementById('reportIncidentForm').reset();
    new bootstrap.Modal(document.getElementById('reportIncidentModal')).show();
}

function reportIncidentSubmit(formData) {
    showLoading();
    fetch('/api/v2/admin/compliance/incidents/report/', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('reportIncidentModal')).hide();
            refreshData();
            showSuccess('Incident reported successfully');
        } else {
            showError(data.message || 'Failed to report incident');
        }
        hideLoading();
    })
    .catch(error => {
        showError('Failed to report incident');
        hideLoading();
    });
}

function scheduleTest() {
    // Implementation for scheduling quality test
    showError('Test scheduling functionality coming soon');
}

function handleComplianceIssue(issueId) {
    showLoading();
    fetch(`/api/v2/admin/compliance/issues/${issueId}/`)
        .then(response => response.json())
        .then(data => {
            // Show issue handling modal
            console.log('Compliance issue:', data);
            hideLoading();
        })
        .catch(error => {
            showError('Failed to load compliance issue');
            hideLoading();
        });
}

function dismissAlert(alertId) {
    fetch(`/api/v2/admin/compliance/alerts/${alertId}/dismiss/`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            refreshData();
        }
    })
    .catch(error => {
        showError('Failed to dismiss alert');
    });
}

function viewAuditDetails(auditId) {
    showLoading();
    fetch(`/api/v2/admin/compliance/audits/${auditId}/`)
        .then(response => response.json())
        .then(data => {
            // Show audit details modal
            console.log('Audit details:', data);
            hideLoading();
        })
        .catch(error => {
            showError('Failed to load audit details');
            hideLoading();
        });
}

function addCertification() {
    // Implementation for adding certification
    showError('Certification management coming soon');
}

function viewRequirementDetails(reqId) {
    showLoading();
    fetch(`/api/v2/admin/compliance/requirements/${reqId}/`)
        .then(response => response.json())
        .then(data => {
            // Show requirement details modal
            console.log('Requirement details:', data);
            hideLoading();
        })
        .catch(error => {
            showError('Failed to load requirement details');
            hideLoading();
        });
}

function updateComplianceStatus(reqId) {
    // Implementation for updating compliance status
    showError('Compliance status update coming soon');
}

function refreshData() {
    showLoading();
    fetch('/api/v2/admin/compliance/data/')
        .then(response => response.json())
        .then(data => {
            updateComplianceData(data);
            hideLoading();
        })
        .catch(error => {
            showError('Failed to refresh compliance data');
            hideLoading();
        });
}

function updateComplianceData(data) {
    // Update metrics
    document.getElementById('complianceScore').textContent = data.status?.overall_score || '96%';
    document.getElementById('passedTests').textContent = data.tests?.passed || 0;
    document.getElementById('upcomingAudits').textContent = data.audits?.upcoming || 0;
    document.getElementById('activeCertifications').textContent = data.certifications?.active || 0;

    // Update alerts
    if (data.alerts) {
        updateComplianceAlerts(data.alerts);
    }

    // Update charts
    if (data.charts) {
        updateCharts(data.charts);
    }
}

function updateComplianceAlerts(alerts) {
    const container = document.getElementById('complianceAlertsList');
    if (alerts.length > 0) {
        container.innerHTML = alerts.map(alert => `
            <div class="alert alert-${alert.severity === 'critical' ? 'danger' : alert.severity === 'warning' ? 'warning' : 'info'} alert-dismissible fade show" role="alert">
                <strong>${alert.title}</strong>
                <br><small>${alert.description}</small>
                <br><small class="text-muted">${new Date(alert.date).toLocaleDateString()}</small>
                ${alert.action_required ? `<br><button class="btn btn-sm btn-outline-primary mt-2" onclick="handleComplianceIssue(${alert.id})">Take Action</button>` : ''}
                <button type="button" class="btn-close" onclick="dismissAlert(${alert.id})"></button>
            </div>
        `).join('');
    } else {
        container.innerHTML = `
            <div class="text-center text-muted py-4">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <p>No compliance issues</p>
            </div>
        `;
    }
}

function updateCharts(charts) {
    if (charts.quality_tests && qualityTestsChart) {
        qualityTestsChart.data.datasets[0].data = charts.quality_tests.data;
        qualityTestsChart.update();
    }

    if (charts.trends && complianceTrendsChart) {
        complianceTrendsChart.data.labels = charts.trends.labels;
        complianceTrendsChart.data.datasets[0].data = charts.trends.scores;
        complianceTrendsChart.data.datasets[1].data = charts.trends.pass_rates;
        complianceTrendsChart.update();
    }
}

function showSuccess(message) {
    // Add success message display logic
    console.log('Success:', message);
}
</script>
{% endblock %}